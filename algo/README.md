## ACTIN-Algo

ACTIN-Algo matches a patient record (clinical & molecular data) with available treatments.

This application requires Java 11+ and can be run as follows: 

```
java -cp actin.jar com.hartwig.actin.algo.TreatmentMatcherApplication \
   -clinical_json /path/to/clinical.json \
   -molecular_json /path/to/molecular.json \
   -treatment_database_directory /path/to/potential_treatment_options \
   -output_directory /path/where/output/is/written \
```

The following assumptions are made about the inputs:
 - The clinical JSON adheres to the format that is generated by [ACTIN-Clinical](../clinical/README.md)
 - The molecular JSON is the [ORANGE](https://github.com/hartwigmedical/hmftools/blob/master/orange/README.md) 
 output from the [Hartwig platinum pipeline](https://github.com/hartwigmedical/platinum)
 - The treatment database directory is the output directory of [ACTIN-Treatment](../treatment/README.md)
 
### Treatment matching

Every treatment defined in the treatment database is evaluated independently. 

In case a treatment is a trial, all relevant inclusion and exclusion criteria are evaluated for this trial as well as every criterion 
for any specific cohort within this trial.  

Every criterion evaluates to one of the following options:

Evaluation | Description
---|---
PASS | The patient complies with the inclusion or exclusion criterion.  
PASS_BUT_WARN | The patient complies with the inclusion or exclusion criterion but a manual check is required.
FAIL | The patient does not comply with the inclusion or exclusion criterion. 
UNDETERMINED | The data provided to the inclusion or exclusion criterion is insufficient for determining eligibility.
NOT_IMPLEMENTED | No algo has been defined yet for this criterion.

For every trial (and cohort) an overall evaluation is determined using the following algorithm:
 1. A patient is eligible for a trial (or cohort) only in case all criteria are `PASS` or `PASS_BUT_WARN`.
 1. In case one of the criteria evaluates to a `FAIL` the patient fails overall eligibility for the trial (or cohort). 
 1. In case of no fails but at least one `UNDETERMINED` or `NOT_IMPLEMENTED` evaluation, the overall evaluation is determined 
 to be `UNDETERMINED`.    

The following additional rules are applied for trials versus cohorts:
 1. A patient is eligible for a specific cohort only if the overall evaluation for both the cohort as well as the trial itself are passed.
 1. A patient is eligible for a trial only if it is eligible for at least one of the cohorts within the trial or if the trial has no 
 cohorts defined and the patient passes all criteria for the trial.  

#### Individual criteria algorithms

Inclusion and exclusion criteria can be defined as a set of rules that are combined using composite functions, to determine overall eligibility. 

The following composite functions are available:

Function | Description 
---|---
AND | indicates that all combined rules should be TRUE in order to PASS
OR | indicates that either of combined rules should be TRUE in order to PASS
NOT | indicates that the rule should not be TRUE in order to PASS
WARN_ON_FAIL | indicates that a warning should be displayed in case of FAIL and resolves to PASS_BUT_WARN

Some rules require an additional configuration parameter ("X") that can be set to match the requirements of each trial. The following rules are available:

##### Rules related to general patient characteristics

Rule | When does a patient pass evaluation? | Note
---|---|---
IS_AT_LEAST_18_YEARS_OLD | Current year minus birth year > 18 | PASS_BUT_WARN in case of exactly 18
HAS_WHO_STATUS_OF_AT_MOST_X | WHO <= X

##### Rules related to tumor and lesion locations
 
Rule | When does a patient pass evaluation?
---|---
PRIMARY_TUMOR_LOCATION_BELONGS_ TO_DOID_X | Configured DOID should be equal or be a child of DOID X
HAS_ADVANCED_CANCER | Tumor details > stage III or IV
HAS_METASTATIC_CANCER | Tumor details > stage IV 
HAS_LIVER_METASTASES | Tumor details > hasLiverLesions = 1
HAS_CNS_METASTASES | Tumor details > hasCnsLesions = 1
HAS_ACTIVE_CNS_METASTASES | Tumor details > hasActiveCnsLesions = 1
HAS_SYMPTOMATIC_CNS_METASTASES | Tumor details > hasSymptomaticCnsLesions = 1
HAS_BRAIN_METASTASES | Tumor details > hasBrainLesions = 1
HAS_ACTIVE_BRAIN_METASTASES | Tumor details > hasActiveBrainLesions = 1
HAS_SYMPTOMATIC_BRAIN_METASTASES | Tumor details > hasSymptomaticBrainLesions = 1
HAS_BONE_METASTASES | Tumor details > hasBoneLesions = 1
HAS_MEASURABLE_DISEASE_RECIST | Tumor details > hasMeasurableDiseaseRecist = 1 

##### Rules related to previous cancer treatments or previous primary tumors

Rule | When does a patient pass evaluation? | Note
---|---|---
HAS_EXHAUSTED_SOC_TREATMENTS | T.B.D 
HAS_DECLINED_SOC_TREATMENTS | T.B.D
HAS_HISTORY_OF_SECOND_MALIGNANCY | Prior second primaries > tumorLocation is not empty
SECOND_MALIGNANCY_HAS_BEEN_ CURED_SINCE_X_YEARS | Prior second primaries > tumorLocation is not empty AND active = 0 | Years can often not be reliably evaluated; rule will be combined with other rules or with NOT & WARN_ON_FAIL
HAS_HAD_AT_MOST_X_SYSTEMIC_ TREATMENT_LINES | Prior second primaries > nr of lines in case systemic = 1 <= X
HAS_HAD_IMMUNOTHERAPY_TREATMENT | Prior tumor treatments > category = Immunotherapy
HAS_HAD_MAX_X_NR_ANTI_PD_L1_ OR_PD_1_IMMUNOTHERAPIES | Prior tumor treatments > nr of lines with immunoType Anti-PD-1 or Anti-PD-L1 should be <= X
HAS_HAD_STEM_CELL_TRANSPLANTATION | Prior tumor treatments > category = Stem cell transplantation

##### Rules related to molecular results

Rule | When does a patient pass evaluation?
---|---
MOLECULAR_RESULTS_MUST_BE_AVAILABLE | Ingestion of ORANGE results (later to be extended)

##### Rules related to recent laboratory measurements

Rule | When does a patient pass evaluation?
---|---
HAS_LEUKOCYTES_ABS_OF_AT_LEAST_X | Leukocytes abs => X
HAS_NEUTROPHILS_ABS_OF_AT_LEAST_X | Neutrophils abs => X 
HAS_THROMBOCYTES_ABS_OF_AT_LEAST_X | Thrombocytes abs => X 
HAS_HEMOGLOBIN_G_PER_DL_OF_AT_LEAST_X | Hemoglobin g/dL => X. In case Hb is measured in mmol/L, the value is converted using 
HAS_HEMOGLOBIN_MMOL_PER_L_OF_AT_LEAST_X | Hemoglobin mmol/L => X. In case Hb is measured in g/dL, the value is converted using 
HAS_CREATININE_ULN_OF_AT_MOST_X | Creatinine <= X*ULN (upper limit of normal)
HAS_CREATININE_CLEARANCE_CKD_EPI_OF_AT_LEAST_X | Creatinine clearance (CKD-EPI formula) => X. In case CrCl is measured in another unit, the value is converted using
HAS_CREATININE_CLEARANCE_CG_OF_AT_LEAST_X | Creatinine clearance (Cockcroft-Gault formula) => X. In case CrCl is measured in another unit, the value is converted using
HAS_CREATININE_CLEARANCE_MDRD_OF_AT_LEAST_X | Creatinine clearance (MDRD formula) => X. In case CrCl is measured in another unit, the value is converted using
HAS_TOTAL_BILIRUBIN_ULN_AT_MOST_X | Total Bilirubin <= X*ULN
HAS_DIRECT_BILIRUBIN_ULN_AT_MOST_X | Direct Bilirubin <= X*ULN
HAS_INR_ULN_AT_MOST_X | INR <= X*ULN
HAS_PT_ULN_AT_MOST_X | PT <= X*ULN
HAS_APTT_ULN_AT_MOST_X | APTT <= X*ULN
HAS_ASAT_ULN_OF_AT_MOST_X | ASAT <= X*ULN
HAS_ALAT_ULN_OF_AT_MOST_X | ALAT <= X*ULN
HAS_ALP_ULN_OF_AT_MOST_X | ALP <= X*ULN

##### Rules related to other conditions

Rule | When does a patient pass evaluation? | Note
---|---|---
HAS_SIGNIFICANT_CONCOMITANT_ILLNESS | Prior other conditions > name is not empty
HAS_HISTORY_OF_AUTOIMMUNE_DISEASE | Prior other conditions > configured doid should be equal or be a child of DOID 417
HAS_HISTORY_OF_CARDIAC_DISEASE | Prior other conditions > configured doid should be equal or be a child of DOID 114
HAS_HISTORY_OF_CARDIOVASCULAR_DISEASE | Prior other conditions > configured doid should be equal or be a child of DOID 1287
HAS_HISTORY_OF_LUNG_DISEASE | Prior other conditions > configured doid should be equal or be a child of DOID 850
HAS_HISTORY_STROKE_X_MONTHS | Prior other conditions > configured doid should be equal or be a child of DOID 6713 | Months can often not be evaluated; rule is usually combined with NOT & WARN_ON_FAIL
HAS_HISTORY_TIA_X_MONTHS | Prior other conditions > configured doid should be equal or be a child of DOID 224 | Months can often not be evaluated; rule is usually combined with NOT & WARN_ON_FAIL
HAS_GILBERT_DISEASE | Prior other conditions > configured doid should be equal or be a child of DOID 2739
HAS_CARDIAC_ARRHYTHMIA | Clinical status > hasSigAberrationLatestEcg = 1
HAS_HYPERTENSION | Prior other conditions > configured doid should be equal or be a child of DOID 10763
HAS_KNOWN_MALABSORPTION_SYNDROME | T.B.D.

##### Rules related to infections
Rule | When does a patient pass evaluation?
---|---
HAS_ACTIVE_INFECTION | Clinical status > hasActiveInfection = 1
HAS_KNOWN_HEPATITIS_B_INFECTION | Prior other conditions > configured doid should be equal or be a child of DOID 2043
HAS_KNOWN_HEPATITIS_C_INFECTION | Prior other conditions > configured doid should be equal or be a child of DOID 1883
HAS_KNOWN_HIV_INFECTION | Prior other conditions > configured doid should be equal or be a child of DOID 526

##### Rules depending on current medication

Rule | When does a patient pass evaluation?| Note
---|---|---
HAS_ALLERGY_RELATED_TO_STUDY _MEDICATION | Allergy > Category = medication AND clinicalStatus = active | Exact ingredients cannot yet be automatically evaluated; rule is usually combined with NOT & WARN_ON_FAIL
CURRENTLY_GETS_ANTIBIOTICS _MEDICATION | Medication > type is type of antibiotics
CURRENTLY_GETS_CORTICOSTEROID _MEDICATION | Medication > type is type of corticosteroids
CURRENTLY_GETS_IMMUNOSUPPRESSANT _MEDICATION | T.B.D.
HAS_STABLE_ANTICOAGULANT_DOSING | Medication > type is type of anticoagulants AND only 1 distinct dosage

##### Rules related to toxicity

Rule | When does a patient pass evaluation?
---|---
HAS_TOXICITY_OF_AT_LEAST_GRADE_X | Toxicities > grade => X
HAS_TOXICITY_OF_AT_LEAST_GRADE_X_IN_NEUROPATHY | Toxicities > name = Neuropathy AND grade => X
HAS_TOXICITY_OF_AT_LEAST_GRADE_X_IN_FATIGUE | Toxicities > name = Fatigue AND grade => X
HAS_TOXICITY_OF_AT_LEAST_GRADE_X_IN_VITILIGO | Toxicities > name = Vitiligo AND grade => X
(a.s.o.) | (a.s.o.)

##### Rules related to blood pressure measurements

Rule | When does a patient pass evaluation?
---|---
HAS_SBP_MMHG_OF_AT_MOST_X | Blood pressures > category = Systolic blood pressure AND value <= X
HAS_DBP_MMHG_OF_AT_MOST_X | Blood pressures > category = Diastolic blood pressure AND value <= X

##### Rules related to blood transfusions

Rule | When does a patient pass evaluation?
---|---
HAS_HAD_ERYTHROCYTE_TRANSFUSION_ WITHIN_LAST_X_WEEKS | Blood transfusions > product = Erythrocyte concentrate AND current date minus transfusion date <= X weeks
HAS_HAD_THROMBOCYTE_TRANSFUSION_ WITHIN_LAST_X_WEEKS | Blood transfusions > product = Thrombocyte concentrate AND current date minus transfusion date <= X weeks

##### Rules related to surgery

Rule | When does a patient pass evaluation?
---|---
HAS_HAD_SURGERY_WITHIN_LAST_X_WEEKS | Surgeries > Current date minus latest surgery date <= X weeks


#### Rules that are currently not evaluated

Note that some inclusion and exclusion criteria can be mapped to rules that are currently explicitly set to PASS or explicitly ignored:

Rule | Hard-coded setting
---|---
HAS_BIOPSY_AMENABLE_LESION | PASS
IS_ABLE_AND_WILLING_TO_GIVE_ADEQUATE_INFORMED_CONSENT | ignored
IS_ABLE_AND_WILLING_TO_USE_ADEQUATE_ANTICONCEPTION | ignored
IS_BREASTFEEDING | ignored
IS_PREGNANT | ignored
IS_INVOLVED_IN_STUDY_PROCEDURES | ignored
HAS_LIFE_EXPECTANCY_OF_AT_LEAST_X_WEEKS | ignored
HAS_SIGNIFICANT_CONCOMITANT_ILLNESS | ignored
 
### Version History and Download Links
 - Upcoming (first release) 